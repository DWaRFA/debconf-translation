#!/usr/bin/perl -w
# This is a sample config module. It approximates 
# the questions asked by eximconfig.

# It won't work with buffered output.
$|=1;

# Establish the preliminaries.
print "VERSION 1.0\n";
<>;
print "CAPB backup\n";
<>;
print "TITLE Exim Configuration\n";
<>;
print join ' ', "TEXT medium",
	   "I can do some automatic configuration of your mail system, by",
	   "asking you a number of questions.  Later you may have to confirm",
	   "and/or correct your answers. In any case, comprehensive",
	   "information on configuring exim is in the eximdoc package and in",
	   "/usr/doc/exim/spec.txt\n";
<>;

sub get_type () {
	print "INPUT medium exim/system_type\n";
	<>;
	print "GO\n";
	my $ret=<>;
	chomp $ret;

	# Going back at this point is up to the frontend,
	# since it involves jumping out of this configmodule.
	if ( $ret eq "back") {
		# This is just a placeholder for something not in the spec.
		print "PREVIOUS_MODULE\n";
		<>;
		exit;
	}

	print "GET exim/system_type\n";
	my $systype=<>;
	chomp $systype;

	# Check to see if they want to skip configuration, if so
	# give them the warning and quit.
	if ($systype eq "no configuration") {
		print join ' ', "NOTE high",
			'You chose to not allow exim to configure itself, so',
			'your mail system is currently broken and should not',
			'be used. You should either manually edit the mail',
			'system configuration (perhaps using',
			'/usr/doc/exim/example.conf.gz as a bare bones',
			'example) or run /usr/sbin/eximconfig to configure',
			"it.\n";
		<>;
		print "GO\n";
		<>;
		exit;
	}
}

# This launches the whole thing.
get_type();
