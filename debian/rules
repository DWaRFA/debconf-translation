#!/usr/bin/make -f

# Uncomment this to turn on verbose mode.
#export DH_VERBOSE=1

build:
	$(MAKE)
	dh_testdir

clean:
	dh_testdir
	dh_testroot
	$(MAKE) clean
	dh_clean debian/debconf.changelog

install: build
	dh_testdir
	dh_testroot
	dh_clean -k
	dh_installdirs
	$(MAKE) prefix=`pwd`/debian/tmp install
	$(MAKE) prefix=`pwd`/debian/debconf-doc install-man
	$(MAKE) prefix=`pwd`/debian/debconf-utils install-utils

binary-arch: install
	# Make sure debhelper is going to install the config and templates.
	dh_testversion 2.0.98
	dh_testdir
	dh_testroot
	# Don't modify postrm, I purge differently than normal packages
	# using me.
	dh_installdebconf -n
	dh_installdocs
	dh_installdocs -p debconf-doc doc/namespace.txt doc/hierarchy.txt \
		doc/*.txt doc/*.html doc/TODO doc/CREDITS \
		doc/spec/*.txt doc/spec/*.html doc/spec/*.gif \
		doc/passthrough.txt
	dh_installexamples -p debconf-doc samples/*
	dh_installmenu
	dh_installcron
	# Changelog reduction hack for debconf. Only include top 5 entries.
	perl -ne '$$c++ if /^debconf /; last if $$c > 5 ; print $$_' \
		< debian/changelog > debian/debconf.changelog
	echo "See /usr/share/doc/debconf-doc/changelog.gz for the" >> debian/debconf.changelog
	echo "remainder of this changelog." >> debian/debconf.changelog
	dh_installchangelogs
	dh_strip
	dh_compress
	dh_fixperms
	dh_suidregister
	dh_installdeb
	dh_shlibdeps
	dh_gencontrol
	dh_md5sums
	dh_builddeb

binary-indep: build install
# Nothing to do.

binary: binary-indep binary-arch
.PHONY: build clean binary-indep binary-arch binary install
